# THIS FILE WAS GENERATED BY ANSIBLE home-dir-config PLAYBOOK
# LOCAL CHANGES MAY BE OVERWRITTEN

{% if ssh_canonical_domains is defined %}
################################################################################
# Canonical hostname

CanonicalizeHostname yes
CanonicalDomains {{ ssh_canonical_domains | join(' ') }}

{% endif %}
{% if ssh_bastion_config %}
################################################################################
# VS Code Hosts
{% if ansible_facts['os_family'] == "Windows" %}
    {%- for host in ssh_vscode_hosts %}

Host {{ host }}
    HostName localhost
    Port {{ ssh_vscode_hosts[host]['port'] }}
    {%- endfor %}

{% else %}
    {%- for host in ssh_vscode_hosts %}

Host {{ host }}
    {%- endfor %}

{% endif %}

{% if ansible_facts['os_family'] != "Windows" %}
################################################################################
# SSH Session Multiplexing for bastion hosts

Host grnoc leap skip i2 i2-bldc i2-ctc noaa noaa-bldc noaa-ctc scinet scinet-bldc scinet-ctc
    ControlMaster auto
    ControlPath ~/.ssh/cp-%r@%h:%p
    ControlPersist 5m

{% endif %}
################################################################################
# el6 openssh bastion options

Host grnoc leap skip
    HostKeyAlgorithms +ssh-rsa
    PubkeyAcceptedAlgorithms +ssh-rsa
    KexAlgorithms +diffie-hellman-group14-sha1

################################################################################
# SOCKS proxies

Host grnoc leap skip
    DynamicForward 8080

Host i2 i2-bldc i2-ctc
    DynamicForward 8082

Host noaa noaa-bldc noaa-ctc
    DynamicForward 8081

Host scinet scinet-bldc scinet-ctc
    DynamicForward 8083

################################################################################
# PKCS11 for CAC bastions

Host noaa noaa-bldc noaa-ctc scinet scinet-bldc scinet-ctc
{% if ansible_facts['os_family'] == "Darwin" %}
    PKCS11Provider /usr/lib/ssh-keychain.dylib
{% elif ansible_facts['os_family'] == "Windows" %}
    PKCS11Provider "C:\\Program Files\\OpenSC Project\\OpenSC\\pkcs11\\opensc-pkcs11.dll"
{% else %}
    PKCS11Provider /usr/lib64/pkcs11/opensc-pkcs11.so
{% endif %}

{% if ansible_facts['os_family'] == "Windows" %}
################################################################################
# Port forwarding for VS Code on Windows

Host grnoc leap skip
    {%- for host in ssh_vscode_hosts %}
        {%- if not host.endswith('.nwave.noaa.gov') %}

    LocalForward {{ ssh_vscode_hosts[host]['port'] }} {{ host }}:22
        {%- endif %}
    {%- endfor %}


Host noaa noaa-bldc noaa-ctc
    {%- for host in ssh_vscode_hosts %}
        {%- if host.endswith('.nwave.noaa.gov') %}

    LocalForward {{ ssh_vscode_hosts[host]['port'] }} {{ host }}:22
        {%- endif %}
    {%- endfor %}


{% endif %}

################################################################################
# bastion hosts

Host grnoc leap
    HostName leap.grnoc.iu.edu

Host skip
    HostName skip.grnoc.iu.edu

Host i2 i2-bldc
    HostName bastion.bldc.net.internet2.edu

Host i2-ctc
    HostName bastion.ctc.net.internet2.edu

Host noaa noaa-bldc
    HostName bastion.bldc.nwave.noaa.gov

Host noaa-ctc
    HostName bastion.ctc.nwave.noaa.gov

Host scinet scinet-bldc
    HostName bastion.bldc.scinet.usda.gov

Host scinet-ctc
    HostName bastion.ctc.scinet.usda.gov

{% if ansible_facts['os_family'] != "Windows" %}
################################################################################
# Bastion proxying by hostname

Match originalhost "*.grnoc.iu.edu,!leap.grnoc.iu.edu,!skip.grnoc.iu.edu"
    ProxyJump grnoc

Match originalhost "*.nwave.noaa.gov,!bastion.*.nwave.noaa.gov"
    ProxyJump noaa

Match originalhost "*.scinet.usda.gov,!bastion.*.scinet.usda.gov"
    ProxyJump scinet

{% endif %}
{% endif %}
################################################################################
# host configs
{% for host in ssh_host_configs | dictsort %}

Host {{ host[0] }}
    {%- for name, value in host[1].items() %}
        {%- if value is string or value is integer %}

    {{ name }} {{ value }}
        {%- else %}
            {%- for v in value %}

    {{ name }} {{ v }}
            {%- endfor %}
        {%- endif %}
    {%- endfor %}

{% endfor %}

################################################################################
# Common host configurations

Host *
{% for name, value in ssh_host_common_configs.items() %}
    {{ name }} {{ value }}
{% endfor %}
